"use strict";(self.webpackChunkinterview_prep=self.webpackChunkinterview_prep||[]).push([[63],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var i=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=i.createContext({}),c=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return i.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),h=o,m=d["".concat(s,".").concat(h)]||d[h]||u[h]||a;return n?i.createElement(m,r(r({ref:t},p),{},{components:n})):i.createElement(m,r({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var c=2;c<a;c++)r[c]=n[c];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},707:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return h},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return u}});var i=n(7462),o=n(3366),a=(n(7294),n(3905)),r=["components"],l={title:"The this keyword (JavaScript)",description:"An overview of how the this keyword works in JavaScript",last_modified:new Date("2022-01-31T10:44:35.286Z"),sidebar_label:"The this keyword"},s=void 0,c={unversionedId:"javascript/this-keyword",id:"javascript/this-keyword",title:"The this keyword (JavaScript)",description:"An overview of how the this keyword works in JavaScript",source:"@site/docs/javascript/this-keyword.md",sourceDirName:"javascript",slug:"/javascript/this-keyword",permalink:"/interview-prep/javascript/this-keyword",draft:!1,tags:[],version:"current",frontMatter:{title:"The this keyword (JavaScript)",description:"An overview of how the this keyword works in JavaScript",last_modified:"2022-01-31T10:44:35.286Z",sidebar_label:"The this keyword"},sidebar:"docs",previous:{title:"Spread syntax, rest parameters and destructuring",permalink:"/interview-prep/javascript/spread-syntax-rest-parameters-destructuring"},next:{title:"Compiler API",permalink:"/interview-prep/javascript/typescript/compiler-api"}},p={},u=[{value:"Basic idea",id:"basic-idea",level:2},{value:"Rules for binding <code>this</code>",id:"rules-for-binding-this",level:2},{value:"Default binding",id:"default-binding",level:3},{value:"Implicit binding",id:"implicit-binding",level:3},{value:"Explicit binding",id:"explicit-binding",level:3},{value:"<code>new</code> binding",id:"new-binding",level:3},{value:"Priority of the rules",id:"priority-of-the-rules",level:2},{value:"Lexical <code>this</code>",id:"lexical-this",level:2},{value:"Resources",id:"resources",level:2}],d={toc:u};function h(e){var t=e.components,n=(0,o.Z)(e,r);return(0,a.kt)("wrapper",(0,i.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"An overview of how the this keyword works in JavaScript"),(0,a.kt)("h2",{id:"basic-idea"},"Basic idea"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Every function has access to a ",(0,a.kt)("inlineCode",{parentName:"li"},"this")," reference"),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"this")," reference is assigned a value when creating the ",(0,a.kt)("em",{parentName:"li"},"execution context")," for an execution of the function (see ",(0,a.kt)("a",{parentName:"li",href:"/javascript/scope-closures"},"Scope and closures"),")",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Note that this means that a function's ",(0,a.kt)("inlineCode",{parentName:"li"},"this")," can point to different things based on how it's executed!"),(0,a.kt)("li",{parentName:"ul"},"Run-time binding, not write-time binding! In that sense, it's a bit the opposite of lexical scoping (see ",(0,a.kt)("a",{parentName:"li",href:"/javascript/scope-closures"},"Scope and closures"),")"))),(0,a.kt)("li",{parentName:"ul"},"What the ",(0,a.kt)("inlineCode",{parentName:"li"},"this")," reference points to is determined by a number of rules")),(0,a.kt)("h2",{id:"rules-for-binding-this"},"Rules for binding ",(0,a.kt)("inlineCode",{parentName:"h2"},"this")),(0,a.kt)("h3",{id:"default-binding"},"Default binding"),(0,a.kt)("p",null,"This is the most basic case, where the function is directly called without doing anything special with it"),(0,a.kt)("p",null,"Example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'function logA() {\n    console.log(this.a);\n}\n\nvar a = "test";\n\nlogA();\n')),(0,a.kt)("p",null,"What ",(0,a.kt)("inlineCode",{parentName:"p"},"this")," is bound to depends on ",(0,a.kt)("em",{parentName:"p"},"strict mode"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"If ",(0,a.kt)("em",{parentName:"li"},"strict mode")," is not enabled, the function's ",(0,a.kt)("inlineCode",{parentName:"li"},"this")," points to the global object. Since the global object has a variable ",(0,a.kt)("inlineCode",{parentName:"li"},"a")," with value ",(0,a.kt)("inlineCode",{parentName:"li"},"test"),", the code will print ",(0,a.kt)("inlineCode",{parentName:"li"},"test")),(0,a.kt)("li",{parentName:"ul"},"If ",(0,a.kt)("em",{parentName:"li"},"strict mode")," is enabled, the function's ",(0,a.kt)("inlineCode",{parentName:"li"},"this")," is not allowed to point to the global object. Instead, ",(0,a.kt)("inlineCode",{parentName:"li"},"this")," points to ",(0,a.kt)("inlineCode",{parentName:"li"},"undefined"),", and the code throws a ",(0,a.kt)("inlineCode",{parentName:"li"},"TypeError")," because we tried to access ",(0,a.kt)("inlineCode",{parentName:"li"},"undefined.a"))),(0,a.kt)("h3",{id:"implicit-binding"},"Implicit binding"),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"Implicit binding")," occurs when the function is called through an object that holds a reference to it. In this case, that object is called the ",(0,a.kt)("em",{parentName:"p"},"context object")," and the function's ",(0,a.kt)("inlineCode",{parentName:"p"},"this")," points to the object."),(0,a.kt)("p",null,"Example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'function logA() {\n    console.log(this.a);\n}\n\nconst theObject = {\n    a: "test",\n    logA: logA\n};\n\nconst secondObject = {\n    a: "second",\n    doSomething: logA\n};\n\ntheObject.logA(); // test\nsecondObject.doSomething(); // second\n')),(0,a.kt)("p",null,"One tricky thing: it's easy to lose that implicit binding!"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'function logA() {\n    console.log(this.a);\n}\n\nconst theObject = {\n    a: "test",\n    logA: logA\n};\n\nconst theFunction = theObject.logA; // theFunction now just points to logA\ntheFunction(); // logs undefined (non-strict mode) or throws TypeError (strict mode)\n')),(0,a.kt)("p",null,"As we see above, assigning the function to a variable and then calling it doesn't use ",(0,a.kt)("em",{parentName:"p"},"implicit binding")," anymore. Instead, we fall back to ",(0,a.kt)("em",{parentName:"p"},"default binding"),"."),(0,a.kt)("p",null,"One case where we need to be careful with that is when passing functions around as callbacks. Example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"function logA() {\n    console.log(this.a);\n}\n\nconst theObject = {\n    a: \"test\",\n    logA: logA\n};\n\n// here, we assign the function to an argument and setTimeout calls it later\n// logs undefined (non-strict mode) or throws TypeError (strict mode)\nsetTimeout(theObject.logA, 1000);\n\n// here, we make sure to call logA through theObject\n// logs 'test'\nsetTimeout(function () {\n    theObject.logA();\n}, 1000);\n")),(0,a.kt)("h3",{id:"explicit-binding"},"Explicit binding"),(0,a.kt)("p",null,"As the name suggests, ",(0,a.kt)("em",{parentName:"p"},"explicit binding")," is more explicit about what the function's ",(0,a.kt)("inlineCode",{parentName:"p"},"this")," reference is bound to"),(0,a.kt)("p",null,"Example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'function logA() {\n    console.log(this.a);\n}\n\nconst theObject = {\n    a: "test",\n    logA: logA\n};\n\n// call and apply differ in how to specify the function\'s arguments (not relevant here)\nlogA.call(theObject); // test\nlogA.apply(theObject); // test\n\nconst theFunction = theObject.logA;\ntheFunction(); // logs undefined (non-strict mode) or throws TypeError (strict mode)\nconst boundFunction = theObject.logA.bind(theObject);\nboundFunction(); // test\n\nsetTimeout(theObject.logA.bind(theObject), 1000); // test\n')),(0,a.kt)("p",null,"Some things to notice:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"call")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"apply")," can be used to call a function while explicitly specifying what ",(0,a.kt)("inlineCode",{parentName:"li"},"this")," should point to. You can use these to dynamically call a function with any ",(0,a.kt)("inlineCode",{parentName:"li"},"this")," reference you like."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"bind")," returns a new function that is identical the original function except that its ",(0,a.kt)("inlineCode",{parentName:"li"},"this")," is hard-wired to the argument you passed to ",(0,a.kt)("inlineCode",{parentName:"li"},"bind"),". One use case is passing the function as a callback (see example code above)")),(0,a.kt)("p",null,"Other use case: ",(0,a.kt)("em",{parentName:"p"},"monkey patching")," (extending the behavior of a function defined on an existing object):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'const existingObject = {\n    a: "test",\n    logA: function () {\n        console.log(this.a);\n    }\n};\n\nconst oldFunction = existingObject.logA;\n\nexistingObject.logA = function () {\n    console.log("before");\n    oldFunction.call(this);\n    console.log("after");\n}\n\nexistingObject.logA(); // before, test, after\n')),(0,a.kt)("p",null,"Interesting monkey patching trick: find the source of unwanted console output"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'["log", "warn"].forEach(function (method) {\n    const old = console[method];\n    \n    console[method] = function () {\n        const stack = new Error().stack.split(/\\n/)\n            .filter(line => line !== "Error")\n            .join("\\n");\n\n        return old.apply(console, [...arguments, stack]);\n    };\n});\n')),(0,a.kt)("h3",{id:"new-binding"},(0,a.kt)("inlineCode",{parentName:"h3"},"new")," binding"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"new")," binding occurs when using the keyword ",(0,a.kt)("inlineCode",{parentName:"p"},"new")," to call a function. Invoking a function using the ",(0,a.kt)("inlineCode",{parentName:"p"},"new")," keyword has the following effect:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"A new object is created"),(0,a.kt)("li",{parentName:"ul"},"The new object's ",(0,a.kt)("inlineCode",{parentName:"li"},"__proto__")," points to the function (see ",(0,a.kt)("a",{parentName:"li",href:"/javascript/object-prototypes-classes"},"Object prototypes and classes"),")"),(0,a.kt)("li",{parentName:"ul"},"The new object is set as the ",(0,a.kt)("inlineCode",{parentName:"li"},"this")," binding for that call to the function"),(0,a.kt)("li",{parentName:"ul"},"Unless the function returns something itself, the function call will automatically return the new object")),(0,a.kt)("p",null,"Important: ",(0,a.kt)("inlineCode",{parentName:"p"},"new")," does not require any specific kind of function to be called on! It can be used on any function, and when it does, it modifies the function's behavior according to the above. In this case, the function is sometimes called a ",(0,a.kt)("em",{parentName:"p"},"constructor"),", but it is still just a regular function. The only thing making it behave differently is the ",(0,a.kt)("inlineCode",{parentName:"p"},"new")," keyword."),(0,a.kt)("p",null,"Example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'// the PascalCase name is a convention for function intended to be called with new\n// JavaScript itself doesn\'t care about this\nfunction Test(a) {\n    this.a = a;\n}\n\nconst one = new Test("one");\nconst two = new Test("two");\n\nconsole.log(one.a); // one\nconsole.log(two.a); // two\n')),(0,a.kt)("h2",{id:"priority-of-the-rules"},"Priority of the rules"),(0,a.kt)("p",null,"From highest to lowest:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"new")," binding (overrides all the rest)"),(0,a.kt)("li",{parentName:"ul"},"Explicit binding"),(0,a.kt)("li",{parentName:"ul"},"Implicit binding"),(0,a.kt)("li",{parentName:"ul"},"Default binding")),(0,a.kt)("h2",{id:"lexical-this"},"Lexical ",(0,a.kt)("inlineCode",{parentName:"h2"},"this")),(0,a.kt)("p",null,"One exception to the behavior of ",(0,a.kt)("inlineCode",{parentName:"p"},"this")," inside a function occurs when using ",(0,a.kt)("em",{parentName:"p"},"arrow functions"),". Arrow function's don't follow the rules above. Instead, the ",(0,a.kt)("inlineCode",{parentName:"p"},"this")," inside an arrow function points to the ",(0,a.kt)("inlineCode",{parentName:"p"},"this")," of the surrounding scope."),(0,a.kt)("p",null,"One use case: calling other function on same object from a callback"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'const theObject = {\n    testA: function () {\n        console.log("testA");\n\n        // naive approach, ends up using default binding\n        setTimeout(function () {\n            this.testB(); // TypeError: this.testB is not a function\n        }, 1000);\n\n        // solution without arrow functions\n        const self = this;\n\n        setTimeout(function () {\n            self.testB(); // test\n        }, 2000);\n\n        // solution with arrow functions\n        setTimeout(() => {\n            this.testB();\n        }, 3000);\n    },\n    testB: function () {\n        console.log("testB");\n    }\n};\n\ntheObject.testA();\n')),(0,a.kt)("p",null,"Also note that, because of the fact that arrow functions don't have their own ",(0,a.kt)("inlineCode",{parentName:"p"},"this"),", JavaScript does not allow you to call them using the ",(0,a.kt)("inlineCode",{parentName:"p"},"new")," keyword:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'const Test = () => {\n    this.a = "test";\n}\n\nconst theObject = new Test(); // TypeError\n')),(0,a.kt)("h2",{id:"resources"},"Resources"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{href:"https://github.com/getify/You-Dont-Know-JS",target:"_blank",rel:"nofollow noopener noreferrer"},"You Don't Know JS ",(0,a.kt)("svg",{class:"embedded-fa-icon"},(0,a.kt)("use",{href:"#external-link-alt"})))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{href:"https://remysharp.com/2014/05/23/where-is-that-console-log/",target:"_blank",rel:"nofollow noopener noreferrer"},"Where is that console.log? ",(0,a.kt)("svg",{class:"embedded-fa-icon"},(0,a.kt)("use",{href:"#external-link-alt"}))))))}h.isMDXComponent=!0}}]);