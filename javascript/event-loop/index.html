<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.50">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="msapplication-TileColor" content="#000000">
<meta name="theme-color" content="#ffffff">
<script>const style=document.createElement("style");style.type="text/css",style.textContent=".menu .menu__list .menu__list-item.menu__list-item--collapsed .menu__list{height:0;overflow:hidden}.menu .menu__list .menu__link.menu__link--sublist:after{visibility:visible}.menu .menu__list .menu__list-item.menu__list-item--collapsed .menu__link--sublist:after{visibility:visible}",document.getElementsByTagName("head")[0].appendChild(style)</script>

<title data-react-helmet="true">Event loop (JavaScript) | interview-prep</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Event loop (JavaScript) | interview-prep"><meta data-react-helmet="true" name="description" content="A high-level overview of how JavaScript handles concurrency using its Event Loop"><meta data-react-helmet="true" property="og:description" content="A high-level overview of how JavaScript handles concurrency using its Event Loop"><meta data-react-helmet="true" property="og:url" content="https://shyamzzp.github.io/interview-prep/javascript/event-loop">

<link data-react-helmet="true" rel="shortcut icon" href="/interview-prep/favicon.ico">


<link rel="stylesheet" href="/interview-prep/styles.13a95899.css">


<link rel="preload" href="/interview-prep/styles.528f11ec.js" as="script">

<link rel="preload" href="/interview-prep/runtime~main.00fdd729.js" as="script">

<link rel="preload" href="/interview-prep/main.a2ac2088.js" as="script">

<link rel="preload" href="/interview-prep/1.a97003e5.js" as="script">

<link rel="preload" href="/interview-prep/2.2e8d12a1.js" as="script">

<link rel="preload" href="/interview-prep/92.c467e56e.js" as="script">

<link rel="preload" href="/interview-prep/7ade5073.5f862e9b.js" as="script">

<link rel="preload" href="/interview-prep/17896441.d7ae5b38.js" as="script">

<link rel="preload" href="/interview-prep/0a240d1f.ae58a6af.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<svg style="display: none;"><desc>Font Awesome Free 5.13.0 by @fontawesome - https://fontawesome.com
            License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)</desc>
            <symbol id="external-link-alt" viewBox="0 0 512 512">
                <path d="M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"></path>
            </symbol>
            <symbol id="github" viewBox="0 0 496 512">
                <path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path>
            </symbol></svg>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/interview-prep/"><strong class="navbar__title">Interview Preparation Notes</strong></a></div><div class="navbar__items navbar__items--right"><a target="_blank" rel="noopener noreferrer" href="https://github.com/shyamzzp/interview-prep" class="header-github-link navbar__item navbar__link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/interview-prep/"><strong class="navbar__title">Interview Preparation Notes</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/shyamzzp/interview-prep" class="header-github-link navbar__item navbar__link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/interview-prep/about/about">About these notes</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/about/solving-leetcode-problems">Solving Leetcode Questions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Data</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/interview-prep/data/cap-theorem">CAP theorem</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/data/data-schema-migration">Data schema migration</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/data/sql-nosql-newsql">SQL, NoSQL, NewSQL</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SQL</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/interview-prep/data/sql/acid">ACID properties</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/data/sql/normalization">Database normalization</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/data/sql/optimistic-pessimistic-locking-sql">Optimistic and pessimistic locking in SQL</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/data/sql/transaction-isolation-levels">Transaction isolation levels</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Java</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/interview-prep/java/concurrency">Concurrency</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/java/date-time-api">Date and Time API</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/java/equals">Equals</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/java/exceptions">Exceptions</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/java/generics">Generics</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/java/interfaces">Interfaces</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/java/java-platform-module-system">Java Platform Module System</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/java/lambda-expressions">Lambda expressions</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/java/optional">Optional type</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/java/overloading-overriding-method-hiding">Overloading, overriding and method hiding</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/java/streams">Streams</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concurrency details</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/interview-prep/java/concurrency-details/locking">Locking</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/java/concurrency-details/thread-safety">Thread safety</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/java/concurrency-details/threads">Threads</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">JavaScript</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/interview-prep/javascript/event-loop">Event loop</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/javascript/object-prototypes-classes">Object prototypes and classes</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/javascript/scope-closures">Scope and closures</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/javascript/spread-syntax-rest-parameters-destructuring">Spread syntax, rest parameters and destructuring</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/javascript/this-keyword">The this keyword</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">TypeScript</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/interview-prep/javascript/typescript/compiler-api">Compiler API</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/javascript/typescript/conditional-types">Conditional types</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/javascript/typescript/index-types">Index types</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/javascript/typescript/nullable-types-optional-parameters-properties">Nullable types and optional parameters/properties</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/javascript/typescript/runtime-type-checking">Runtime type checking in TypeScript</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/javascript/typescript/type-guards">Type guards</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Mindset</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/interview-prep/mindset/ask-dumb-questions">Ask the dumb questions</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/mindset/concepts-not-code">Concepts, not code</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/mindset/fail-fast">Fail fast</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/mindset/hammock-driven-development">Hammock-driven development</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/mindset/it-depends">It depends</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/mindset/its-about-people">It&#x27;s about people</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/mindset/keep-it-simple">Keep it simple</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/mindset/pragmatism-imperfectionism">Pragmatism and imperfectionism</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/mindset/work-life-balance">Work-life balance</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Preparation (Java)</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/interview-prep/preparation/algorithms">Algorithms</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/preparation/bit-manipulation">Bit Manipulation</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/preparation/common-problems">Common Problems</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/preparation/comparators">Comparators</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/preparation/graph">Graph</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/preparation/linked-list">Linked List</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/preparation/map">Map</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/preparation/math">Math</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/preparation/priority-queue">Priority Queue</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/preparation/search-algorithms">Search Algorithms</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/preparation/snippets">Snippets</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/preparation/sorting-algorithms">Sorting Algorithms</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/preparation/tree">Tree</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Processes and techniques</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/interview-prep/processes-techniques/branch-by-abstraction-application-strangulation">Branch By Abstraction and application strangulation</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/processes-techniques/client-first-design">Client-first design</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/processes-techniques/code-review-collaboration">Code review and collaboration workflows</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/processes-techniques/dealing-with-uncertainty">Dealing with uncertainty</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/processes-techniques/feature-flags">Feature flags</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/processes-techniques/issue-troubleshooting">Issue troubleshooting</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/processes-techniques/managing-technical-debt">Managing technical debt</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/processes-techniques/refactoring">Refactoring</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/processes-techniques/small-commits-pull-requests">Small commits and pull requests</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/processes-techniques/static-analysis">Static analysis</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/processes-techniques/team-decision-making">Team decision-making</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/processes-techniques/testing">Testing</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/processes-techniques/trunk-based-development">Trunk Based Development</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Testing details</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/interview-prep/processes-techniques/testing-details/testing-after-production">Testing after production</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/processes-techniques/testing-details/testing-patterns">Testing patterns</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Soft skills</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/interview-prep/soft-skills/expectation-management">Expectation management</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Web</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/interview-prep/web/cookies-web-storage">Cookies and Web Storage</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CSS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/interview-prep/web/css/box-model">Box model</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/web/css/browser-compatibility">Browser compatibility</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/web/css/flexbox">Flexbox</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/web/css/grids">Grids</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/web/css/inheritance-cascade-specificity">Inheritance, the cascade and specificity</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/web/css/naming-classes">Naming classes</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/web/css/positioning">Positioning</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/web/css/responsive-design">Responsive design</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/web/css/sass-scss">Sass/SCSS</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/web/css/selectors">Selectors</a></li><li class="menu__list-item"><a class="menu__link" href="/interview-prep/web/css/units">Units</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Event loop (JavaScript)</h1></header><div class="markdown"><p>A high-level overview of how JavaScript handles concurrency using its Event Loop</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="javascript-and-concurrency"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#javascript-and-concurrency" title="Direct link to heading">#</a>JavaScript and concurrency</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="single-threaded"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#single-threaded" title="Direct link to heading">#</a>Single-threaded</h3><p>A JavaScript program typically executes inside a <em>single thread</em> (let&#x27;s ignore some less common cases where code spawns <a href="https://nodejs.org/api/child_process.html" target="_blank" rel="nofollow noopener noreferrer">child processes <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a>, <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="nofollow noopener noreferrer">Web Workers <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a>, <a href="https://nodejs.org/api/worker_threads.html" target="_blank" rel="nofollow noopener noreferrer">Worker Threads <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a> or similar)</p><ul><li>This means that, at any point in time, at most one code path is executing. </li><li>This does not prevent JavaScript from making it seem like multiple things are going on at the same time!<ul><li>Example: while a part of the JavaScript code is getting some data from the backend to update the page with, another part of the code might be creating some visual effects whenever the user hovers over a button</li><li>JavaScript is able to accomplish this using a combination of <em>asynchronous calls</em> and the <em>Event Loop</em></li></ul></li></ul><p>When making <em>asynchronous calls</em>, JavaScript code tells the JavaScript engine something like &quot;ok, I&#x27;m done for now, but please perform this task for me and pass the resulting data to this function I&#x27;m giving you&quot;. The task in question could be something like retrieving data from a URL. When the engine has retrieved the data, it can then execute the program starting from the function it received. But while the engine was waiting for the data, other pieces of JavaScript that are triggered by other events can already be run. </p><p>The part of the engine responsible for determining what code to run when is the <em>Event Loop</em>, which in essence constantly checks if there is something ready to be executed and also determines what to execute first in case there are multiple candidates. See also <a aria-current="page" class="active" href="/interview-prep/javascript/event-loop#the-event-loop">The Event Loop</a>.</p><p>Note that, although the JavaScript code runs in a single thread, the engine might use several threads for performing asynchronous operations like retrieving data from a server.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="non-preemptive-run-to-completion"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#non-preemptive-run-to-completion" title="Direct link to heading">#</a>Non-preemptive (run-to-completion)</h3><p>Another important thing about JavaScript concurrency is that it is <em>non-preemptive</em>. Basically, that means that the execution of a piece of code will never be interrupted unless the code itself asks for it.</p><p>In a lot of languages, things are quite different. In Java, for example, concurrency is achieved using threads which could be interrupted (preempted) at any moment. This means that even code like <code>sharedCounter++</code> can lead to unexpected behavior in programs using concurrency, as it&#x27;s possible that the execution is interrupted after the current value is read but before the new value is written. If that happens and some other code changed the counter during the interruption, your shared counter will probably not behave as you intended. This situation is called a <em>race condition</em>. See also <a href="/java/concurrency-details/threads">Java threads</a>.</p><p>Because JavaScript concurrency is <em>non-preemptive</em>, we don&#x27;t have this problem. Instead, we have the guarantee that synchronous code (no asynchronous calls) will always be executed atomically, entirely, to completion.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> currentValue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sharedCounter</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// any amount of synchronous code</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// guaranteed that the code didn&#x27;t get interrupted before reaching this line</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">sharedCounter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> currentValue </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span></div></div></div></div></div><p>As JavaScript normally only runs in a single thread, the fact that the code above didn&#x27;t get interrupted also means that we have the guarantee that <code>sharedCounter</code> didn&#x27;t change in the meantime (again, we are ignoring the exceptional cases where code might for example be sharing data with <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="nofollow noopener noreferrer">Web Workers <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a> or <a href="https://nodejs.org/api/worker_threads.html" target="_blank" rel="nofollow noopener noreferrer">Worker Threads <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a>, see also <a href="https://www.sitepen.com/blog/the-return-of-sharedarraybuffers-and-atomics/" target="_blank" rel="nofollow noopener noreferrer">The Return of SharedArrayBuffers and Atomics <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a>)</p><p>The code will only be interrupted if it chooses to be interrupted (by making an asynchronous call). Example:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> currentValue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sharedCounter</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// execution gets interrupted here</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> somePromise</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// note sure what has executed in the meantime</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">sharedCounter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> currentValue </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span></div></div></div></div></div><p>The fact that code runs until it chooses to be interrupted greatly reduces the potential for timing bugs. However, you can still create timing bugs by making invalid assumptions about the order in which different pieces of code will run if they are all waiting for some asynchronous call to complete.</p><p>Another consequence of the run-to-completion behavior is that a long-running synchronous operation prevents any other code from running. A two-second synchronous operation means that, for two seconds, your webpage will freeze or your server will be unresponsive. This means that you need to be very careful about preventing long-running synchronous operations. Even if a piece of code has everything it needs to continue, you might actually want it to be interrupted in order to give other code a chance to run on the single thread that is available. See also <a aria-current="page" class="active" href="/interview-prep/javascript/event-loop#dont-block-the-event-loop">Don&#x27;t block the Event Loop</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="the-event-loop"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-event-loop" title="Direct link to heading">#</a>The Event Loop</h2><p>The <em>Event Loop</em> is responsible for determining when which piece of the program gets executed, based on any events that the program&#x27;s code is waiting for. These events could be timers, the user interacting with HTML elements, data being retrieved from a server, ...</p><p>The exact implementation and behavior of the Event Loop is different for different JavaScript engines (browsers differ in their behavior, Node.js has its own behavior, ...). However, there are some concepts that they all share:</p><ul><li><strong>Queues:</strong> There several queues holding callbacks that are ready to be executed. Within a queue, tasks will be executed in order.</li><li><strong>Tasks:</strong> Tasks are the &quot;normal&quot; callbacks to be executed. <ul><li>Examples: expired timers (including Node.js <code>setImmediate()</code>), HTML click events, ...</li></ul></li><li><strong>Microtasks:</strong> Microtasks take priority over normal tasks. They are used for things that should execute immediately after the currently running code has finished. Whenever the engine finishes a task, it first checks for any microtasks to be executed. The next normal task will only get executed once there are no more microtasks waiting.<ul><li>Example: Promise callbacks. Note that, even if a Promise has already been resolved, its callback is executed asynchronously through a microtask.</li><li>Example: Node.js has <code>process.nextTick()</code> which also allows scheduling microtasks</li></ul></li></ul><p>You could imagine the code for the event loop to look a bit like this (adapted from <a href="https://github.com/atotic/event-loop" target="_blank" rel="nofollow noopener noreferrer">Event loop explainer <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a>):</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// get first normal task from some queue</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    task </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> eventLoop</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">nextTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// execute that single task</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// execute all microtasks until none are left</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    eventLoop</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">executeMicrotasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// browser-specific: render if needed</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eventLoop</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">needsRendering</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        eventLoop</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">        </span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div></div></div><p>Note: The JavaScript specification doesn&#x27;t specify exactly how the engine should select the next task to execute. It does specify that the engine needs to take the first task from some queue, but the engine can still choose <em>which</em> queue to pick a task from.</p><p>Note: Take a look at <a href="https://dev.to/lunaticmonk/understanding-the-node-js-event-loop-phases-and-how-it-executes-the-javascript-code-1j9" target="_blank" rel="nofollow noopener noreferrer">Understanding the Node.js event loop phases and how it executes the JavaScript code. <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a> for more details on the event loop used by Node.js. It includes details on the different phases used by the event loop, as well as the confusingly named <code>setImmediate()</code> and <code>process.nextTick()</code>. Interestingly, <code>setImmediate()</code> is less immediate than <code>process.nextTick()</code>, and <code>process.nextTick()</code> doesn&#x27;t wait until the next tick (iteration of the event loop through all of its phases) but actually executes in the current one.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="example-execution"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-execution" title="Direct link to heading">#</a>Example execution</h3><p>Let&#x27;s take a look at how the engine executes the following script (from <a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/" target="_blank" rel="nofollow noopener noreferrer">Tasks, microtasks, queues and schedules <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a>):</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;script start&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;setTimeout&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;promise1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;promise2&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;script end&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></div></div></div></div></div><p>When we execute this script, it happens as follows:</p><ol><li>There is an initial task to run the script<ol><li>The code logs <code>script start</code></li><li>The callback for setTimeout is scheduled as a <em>task</em></li><li>The first Promise callback is scheduled as a <em>microtask</em></li><li>The code logs <code>script end</code></li></ol></li><li>The microtask for the first Promise callback is executed<ol><li>The code logs <code>promise1</code></li><li>The second Promise callback is scheduled as a <em>microtask</em></li></ol></li><li>The microtask for the second Promise callback is executed<ol><li>The code logs <code>promise2</code></li></ol></li><li>The first iteration of our event loop pseudocode (see above) is now complete</li><li>Next task: the callback for setTimeout<ol><li>The code logs <code>setTimeout</code></li></ol></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="dont-block-the-event-loop"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#dont-block-the-event-loop" title="Direct link to heading">#</a>Don&#x27;t block the Event Loop</h2><p>As said above, JavaScript runs in a single thread and the execution of a piece of code is never interrupted unless the code itself chooses to wait for some kind of event.</p><p>While this prevents a lot of concurrency bugs, it also means that long-running synchronous code completely prevents the event loop from doing anything else:</p><ul><li>A long synchronous operation on a webpage prevents any click events, responses from the server, ... from being processed. The worst case is an infinite synchronous loop, which freezes the entire page.</li><li>A long synchronous operation on a Node.js server prevents the server from doing anything else, making it seem unresponsive. The worst case is an infinite synchronous loop, which makes the server appear to be down from the outside world, while the server itself and process managers still consider the server to be running.</li><li>Basically, it is up to you to ensure that you don&#x27;t block the event loop for long periods of time so that all kinds of tasks are able to run without having to wait for a long amount of time.</li></ul><p>The following code is an example of how synchronous code blocks asynchronous callbacks:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;setTimeout&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> start </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;synchronous&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div></div></div><p>Although setTimeout callback is scheduled to execute after 0 milliseconds, it only executes after one second once the synchronous loop is done executing. The synchronous operation is blocking other tasks from being executed.</p><p>Note that, in extreme cases where the microtask queue stays full, the microtask queue can also block normal tasks from being executed. As an example, see the following piece of code.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;setTimeout&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">recursivePromise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;recursivePromise&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> start </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">recursivePromise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">recursivePromise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></div></div></div></div></div><p>Although setTimeout callback is scheduled to execute after 0 milliseconds, it only executes after one second once our recursive function stops adding microtasks to the queue.</p><p>In Node.js, there is pool of workers that handle asynchronous tasks like file reads. It&#x27;s also possible to block the workers in this pool, for example by asking them to read the complete contents of a very large file. In essence, if you give a worker in the pool a long-running task, you are basically reducing the size of the worker pool by one until that task completes. If you somehow manage to get all of the workers in the pool working on a long-running task, the pool will not be able to process any other tasks that the code is waiting for.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="recommendation-asynchronous-where-possible"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#recommendation-asynchronous-where-possible" title="Direct link to heading">#</a>Recommendation: asynchronous where possible</h3><p>Unless you&#x27;re writing a simple script, go for asynchronous operations instead of synchronous ones where possible. Regarding Node.js specifically, if you are writing an actual server (rather than a script) you should avoid using any of the synchronous crypto, compression, file system, child process or other calls. Instead, use their asynchronous versions.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="recommendation-watch-out-with-json-and-regexes"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#recommendation-watch-out-with-json-and-regexes" title="Direct link to heading">#</a>Recommendation: watch out with JSON and regexes</h3><p>JSON stringifying and parsing happens synchronously. While these operations scale linearly with the length of the input, they can take a long time for large input. This means you could suffer a DOS attack if your server using Node.js receives very large JSON inputs.</p><p>Some ways to mitigate this:</p><ul><li>Reject large input</li><li>Use alternative ways of parsing JSON, like <a href="https://www.npmjs.com/package/JSONStream" target="_blank" rel="nofollow noopener noreferrer">JSONStream <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a> or <a href="https://www.npmjs.com/package/bfj" target="_blank" rel="nofollow noopener noreferrer">Big-Friendly JSON <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></li></ul><p>Regexes are also evaluated synchronously. Some particular regular expressions might need an exponential number of passes through the input string. That means that the time it takes to match a string against the regular expression grows exponentially as the input string grows. Large input provided to these regular expressions can basically render a Node.js server unresponsive for long periods of time. This is called a <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" target="_blank" rel="nofollow noopener noreferrer">ReDoS <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a> vulnerability.</p><p>Some ways to mitigate this:</p><ul><li>Reject large input</li><li>Avoid regular expressions using nested quantifiers (like <code>(a+)*</code>), backreferences (like <code>(a.*) \1</code>, ...)</li><li>Use simple string matches (like <code>indexOf</code>) instead of regexes where possible</li><li>Use tools like <a href="https://github.com/substack/safe-regex" target="_blank" rel="nofollow noopener noreferrer">safe-regex <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a> that can help you identify some (but not all) vulnerable regexes</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="recommendation-task-partitioning"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#recommendation-task-partitioning" title="Direct link to heading">#</a>Recommendation: task partitioning</h3><p>Imagine that you have a Node.js server that accepts two types of requests:</p><ul><li>Type A, needing 1ms of synchronous computation</li><li>Type B: needing 500ms of synchronous computation</li></ul><p>Let&#x27;s assume that every second the server receives 100 requests of type A and 1 request of type B. If 50 requests of type A come in just after a request of type B, all of those relatively fast requests needs to wait for 500ms before they can even start to be processed (making it seem to the client like they also took 500ms). One large synchronous request can have an enormous impact on the waiting time of lots of smaller requests.</p><p>You can solve this situation using <em>task partitioning</em>.</p><ul><li>Basic idea: minimize the variation in task times by chopping up large tasks into smaller ones</li><li>Application to example above:<ul><li>Rewrite the code for requests of type B: Instead of performing all of the computations in one big synchronous chunk, we let the code peform a small part of the computations (maybe a few ms worth of computation) and then call <code>setTimeout</code> with a delay of 0 and a callback that performs the next chunk of computation (which is put at the end of the relevant queue). </li><li>This way, all tasks in the event loop take at most a few ms, making the server appear to be a lot faster and more responsive to clients issuing requests of type A.</li></ul></li></ul><p>Note: depending on how asynchronous operations are handed by the engine, you should also be careful about long-running asynchronous tasks</p><ul><li>Example: workers in the Node.js worker pool that are asked to read the complete contents of some potentially huge files can end end up blocking the worker pool</li><li>You can apply task partitioning here by manually specifying which part of the file to read or using a streaming API to read the files.</li></ul><p>Also note that task partitioning shouldn&#x27;t be taken too far, as there is also some overhead involved in the creation of a whole lot of tasks vs. a single long-running task.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="recommendation-offloading"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#recommendation-offloading" title="Direct link to heading">#</a>Recommendation: offloading</h3><p>For some kinds of long-running synchronous computations, task partitioning is very hard to achieve. In this case, you can spare the event loop (and potentially even make better use of the available CPU cores) by running those computations inside their own <a href="https://nodejs.org/api/child_process.html" target="_blank" rel="nofollow noopener noreferrer">child process <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a>, <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="nofollow noopener noreferrer">Web Worker <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a>, ... </p><p>Do note that there is some overhead for creating these and communicating with them. You can mitigate this overhead by maintaining a pool of reusable workers/processes (instead of creating new ones each time) and limiting the amount of communication that is needed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="resources"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#resources" title="Direct link to heading">#</a>Resources</h2><ul><li><a href="https://github.com/getify/You-Dont-Know-JS" target="_blank" rel="nofollow noopener noreferrer">You Don&#x27;t Know JS <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop" target="_blank" rel="nofollow noopener noreferrer">Concurrency model and the event loop <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></li><li><a href="https://github.com/atotic/event-loop" target="_blank" rel="nofollow noopener noreferrer">Event loop explainer <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></li><li><a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/" target="_blank" rel="nofollow noopener noreferrer">Tasks, microtasks, queues and schedules <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></li><li><a href="https://dev.to/lunaticmonk/understanding-the-node-js-event-loop-phases-and-how-it-executes-the-javascript-code-1j9" target="_blank" rel="nofollow noopener noreferrer">Understanding the Node.js event loop phases and how it executes the JavaScript code. <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></li><li><a href="https://nodejs.org/en/docs/guides/dont-block-the-event-loop/" target="_blank" rel="nofollow noopener noreferrer">Don&#x27;t Block the Event Loop (or the Worker Pool) <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></li></ul></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/interview-prep/java/concurrency-details/threads"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« Threads (Java)</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/interview-prep/javascript/object-prototypes-classes"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">Object prototypes and classes (JavaScript) »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#javascript-and-concurrency" class="contents__link">JavaScript and concurrency</a><ul><li><a href="#single-threaded" class="contents__link">Single-threaded</a></li><li><a href="#non-preemptive-run-to-completion" class="contents__link">Non-preemptive (run-to-completion)</a></li></ul></li><li><a href="#the-event-loop" class="contents__link">The Event Loop</a><ul><li><a href="#example-execution" class="contents__link">Example execution</a></li></ul></li><li><a href="#dont-block-the-event-loop" class="contents__link">Don&#39;t block the Event Loop</a><ul><li><a href="#recommendation-asynchronous-where-possible" class="contents__link">Recommendation: asynchronous where possible</a></li><li><a href="#recommendation-watch-out-with-json-and-regexes" class="contents__link">Recommendation: watch out with JSON and regexes</a></li><li><a href="#recommendation-task-partitioning" class="contents__link">Recommendation: task partitioning</a></li><li><a href="#recommendation-offloading" class="contents__link">Recommendation: offloading</a></li></ul></li><li><a href="#resources" class="contents__link">Resources</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>copyright © 2022 shyamzzp.</div></div></div></footer>
</div>

<script src="/interview-prep/styles.528f11ec.js"></script>

<script src="/interview-prep/runtime~main.00fdd729.js"></script>

<script src="/interview-prep/main.a2ac2088.js"></script>

<script src="/interview-prep/1.a97003e5.js"></script>

<script src="/interview-prep/2.2e8d12a1.js"></script>

<script src="/interview-prep/92.c467e56e.js"></script>

<script src="/interview-prep/7ade5073.5f862e9b.js"></script>

<script src="/interview-prep/17896441.d7ae5b38.js"></script>

<script src="/interview-prep/0a240d1f.ae58a6af.js"></script>

<script>window.goatcounter={no_events:!0},window.addEventListener("click",t=>{if(!window.goatcounter.count)return;if(!t.target)return;const e=t.target.getAttribute("href");!e||e.startsWith("http")||e.startsWith("#")||setTimeout(()=>{window.goatcounter.count()})})</script>
<script data-goatcounter="https://interview-prep.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>