<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.50">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="msapplication-TileColor" content="#000000">
<meta name="theme-color" content="#ffffff">
<script>const style=document.createElement("style");style.type="text/css",style.textContent=".menu .menu__list .menu__list-item.menu__list-item--collapsed .menu__list{height:0;overflow:hidden}.menu .menu__list .menu__link.menu__link--sublist:after{visibility:visible}.menu .menu__list .menu__list-item.menu__list-item--collapsed .menu__link--sublist:after{visibility:visible}",document.getElementsByTagName("head")[0].appendChild(style)</script>

<title data-react-helmet="true">Branch By Abstraction and application strangulation | interview-prep</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Branch By Abstraction and application strangulation | interview-prep"><meta data-react-helmet="true" name="description" content="These techniques allow breaking large changes into chunks of smaller changes that don&#x27;t break the system"><meta data-react-helmet="true" property="og:description" content="These techniques allow breaking large changes into chunks of smaller changes that don&#x27;t break the system"><meta data-react-helmet="true" property="og:url" content="https://interview-prep.shyamzzp.com/processes-techniques/branch-by-abstraction-application-strangulation">

<link data-react-helmet="true" rel="shortcut icon" href="/favicon.ico">


<link rel="stylesheet" href="/styles.13a95899.css">


<link rel="preload" href="/styles.a100f0e2.js" as="script">

<link rel="preload" href="/runtime~main.10117a48.js" as="script">

<link rel="preload" href="/main.b4872909.js" as="script">

<link rel="preload" href="/1.a97003e5.js" as="script">

<link rel="preload" href="/2.2e8d12a1.js" as="script">

<link rel="preload" href="/92.eb9bf858.js" as="script">

<link rel="preload" href="/ec1ed54d.e8f02b85.js" as="script">

<link rel="preload" href="/17896441.d7ae5b38.js" as="script">

<link rel="preload" href="/2cbba78a.6e8f96cf.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<svg style="display: none;"><desc>Font Awesome Free 5.13.0 by @fontawesome - https://fontawesome.com
            License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)</desc>
            <symbol id="external-link-alt" viewBox="0 0 512 512">
                <path d="M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"></path>
            </symbol>
            <symbol id="github" viewBox="0 0 496 512">
                <path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path>
            </symbol></svg>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><strong class="navbar__title">Interview Preparation Notes</strong></a></div><div class="navbar__items navbar__items--right"><a target="_blank" rel="noopener noreferrer" href="https://github.com/shyamzzp/interview-prep" class="header-github-link navbar__item navbar__link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><strong class="navbar__title">Interview Preparation Notes</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/shyamzzp/interview-prep" class="header-github-link navbar__item navbar__link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/about/about">About these notes</a></li><li class="menu__list-item"><a class="menu__link" href="/about/contributing">Contributing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Data</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/data/cap-theorem">CAP theorem</a></li><li class="menu__list-item"><a class="menu__link" href="/data/data-schema-migration">Data schema migration</a></li><li class="menu__list-item"><a class="menu__link" href="/data/sql-nosql-newsql">SQL, NoSQL, NewSQL</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SQL</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/data/sql/acid">ACID properties</a></li><li class="menu__list-item"><a class="menu__link" href="/data/sql/normalization">Database normalization</a></li><li class="menu__list-item"><a class="menu__link" href="/data/sql/optimistic-pessimistic-locking-sql">Optimistic and pessimistic locking in SQL</a></li><li class="menu__list-item"><a class="menu__link" href="/data/sql/transaction-isolation-levels">Transaction isolation levels</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Java</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/java/concurrency">Concurrency</a></li><li class="menu__list-item"><a class="menu__link" href="/java/date-time-api">Date and Time API</a></li><li class="menu__list-item"><a class="menu__link" href="/java/equals">Equals</a></li><li class="menu__list-item"><a class="menu__link" href="/java/exceptions">Exceptions</a></li><li class="menu__list-item"><a class="menu__link" href="/java/generics">Generics</a></li><li class="menu__list-item"><a class="menu__link" href="/java/interfaces">Interfaces</a></li><li class="menu__list-item"><a class="menu__link" href="/java/java-platform-module-system">Java Platform Module System</a></li><li class="menu__list-item"><a class="menu__link" href="/java/lambda-expressions">Lambda expressions</a></li><li class="menu__list-item"><a class="menu__link" href="/java/optional">Optional type</a></li><li class="menu__list-item"><a class="menu__link" href="/java/overloading-overriding-method-hiding">Overloading, overriding and method hiding</a></li><li class="menu__list-item"><a class="menu__link" href="/java/streams">Streams</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concurrency details</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/java/concurrency-details/locking">Locking</a></li><li class="menu__list-item"><a class="menu__link" href="/java/concurrency-details/thread-safety">Thread safety</a></li><li class="menu__list-item"><a class="menu__link" href="/java/concurrency-details/threads">Threads</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">JavaScript</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/javascript/event-loop">Event loop</a></li><li class="menu__list-item"><a class="menu__link" href="/javascript/object-prototypes-classes">Object prototypes and classes</a></li><li class="menu__list-item"><a class="menu__link" href="/javascript/scope-closures">Scope and closures</a></li><li class="menu__list-item"><a class="menu__link" href="/javascript/spread-syntax-rest-parameters-destructuring">Spread syntax, rest parameters and destructuring</a></li><li class="menu__list-item"><a class="menu__link" href="/javascript/this-keyword">The this keyword</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">TypeScript</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/javascript/typescript/compiler-api">Compiler API</a></li><li class="menu__list-item"><a class="menu__link" href="/javascript/typescript/conditional-types">Conditional types</a></li><li class="menu__list-item"><a class="menu__link" href="/javascript/typescript/index-types">Index types</a></li><li class="menu__list-item"><a class="menu__link" href="/javascript/typescript/nullable-types-optional-parameters-properties">Nullable types and optional parameters/properties</a></li><li class="menu__list-item"><a class="menu__link" href="/javascript/typescript/runtime-type-checking">Runtime type checking in TypeScript</a></li><li class="menu__list-item"><a class="menu__link" href="/javascript/typescript/type-guards">Type guards</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Mindset</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/mindset/ask-dumb-questions">Ask the dumb questions</a></li><li class="menu__list-item"><a class="menu__link" href="/mindset/concepts-not-code">Concepts, not code</a></li><li class="menu__list-item"><a class="menu__link" href="/mindset/fail-fast">Fail fast</a></li><li class="menu__list-item"><a class="menu__link" href="/mindset/hammock-driven-development">Hammock-driven development</a></li><li class="menu__list-item"><a class="menu__link" href="/mindset/it-depends">It depends</a></li><li class="menu__list-item"><a class="menu__link" href="/mindset/its-about-people">It&#x27;s about people</a></li><li class="menu__list-item"><a class="menu__link" href="/mindset/keep-it-simple">Keep it simple</a></li><li class="menu__list-item"><a class="menu__link" href="/mindset/pragmatism-imperfectionism">Pragmatism and imperfectionism</a></li><li class="menu__list-item"><a class="menu__link" href="/mindset/work-life-balance">Work-life balance</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Preparation (Java)</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/preparation/algorithms">Algorithms</a></li><li class="menu__list-item"><a class="menu__link" href="/preparation/bit-manipulation">Bit Manipulation</a></li><li class="menu__list-item"><a class="menu__link" href="/preparation/common-problems">Common Problems</a></li><li class="menu__list-item"><a class="menu__link" href="/preparation/comparators">Comparators</a></li><li class="menu__list-item"><a class="menu__link" href="/preparation/graph">Graph</a></li><li class="menu__list-item"><a class="menu__link" href="/preparation/linked-list">Linked List</a></li><li class="menu__list-item"><a class="menu__link" href="/preparation/map">Map</a></li><li class="menu__list-item"><a class="menu__link" href="/preparation/math">Math</a></li><li class="menu__list-item"><a class="menu__link" href="/preparation/priority-queue">Priority Queue</a></li><li class="menu__list-item"><a class="menu__link" href="/preparation/search-algorithms">Search Algorithms</a></li><li class="menu__list-item"><a class="menu__link" href="/preparation/snippets">Snippets</a></li><li class="menu__list-item"><a class="menu__link" href="/preparation/sorting-algorithms">Sorting Algorithms</a></li><li class="menu__list-item"><a class="menu__link" href="/preparation/tree">Tree</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Processes and techniques</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/processes-techniques/branch-by-abstraction-application-strangulation">Branch By Abstraction and application strangulation</a></li><li class="menu__list-item"><a class="menu__link" href="/processes-techniques/client-first-design">Client-first design</a></li><li class="menu__list-item"><a class="menu__link" href="/processes-techniques/code-review-collaboration">Code review and collaboration workflows</a></li><li class="menu__list-item"><a class="menu__link" href="/processes-techniques/dealing-with-uncertainty">Dealing with uncertainty</a></li><li class="menu__list-item"><a class="menu__link" href="/processes-techniques/feature-flags">Feature flags</a></li><li class="menu__list-item"><a class="menu__link" href="/processes-techniques/issue-troubleshooting">Issue troubleshooting</a></li><li class="menu__list-item"><a class="menu__link" href="/processes-techniques/managing-technical-debt">Managing technical debt</a></li><li class="menu__list-item"><a class="menu__link" href="/processes-techniques/refactoring">Refactoring</a></li><li class="menu__list-item"><a class="menu__link" href="/processes-techniques/small-commits-pull-requests">Small commits and pull requests</a></li><li class="menu__list-item"><a class="menu__link" href="/processes-techniques/static-analysis">Static analysis</a></li><li class="menu__list-item"><a class="menu__link" href="/processes-techniques/team-decision-making">Team decision-making</a></li><li class="menu__list-item"><a class="menu__link" href="/processes-techniques/testing">Testing</a></li><li class="menu__list-item"><a class="menu__link" href="/processes-techniques/trunk-based-development">Trunk Based Development</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Testing details</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/processes-techniques/testing-details/testing-after-production">Testing after production</a></li><li class="menu__list-item"><a class="menu__link" href="/processes-techniques/testing-details/testing-patterns">Testing patterns</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Soft skills</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/soft-skills/expectation-management">Expectation management</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Web</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/web/cookies-web-storage">Cookies and Web Storage</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CSS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/web/css/box-model">Box model</a></li><li class="menu__list-item"><a class="menu__link" href="/web/css/browser-compatibility">Browser compatibility</a></li><li class="menu__list-item"><a class="menu__link" href="/web/css/flexbox">Flexbox</a></li><li class="menu__list-item"><a class="menu__link" href="/web/css/grids">Grids</a></li><li class="menu__list-item"><a class="menu__link" href="/web/css/inheritance-cascade-specificity">Inheritance, the cascade and specificity</a></li><li class="menu__list-item"><a class="menu__link" href="/web/css/naming-classes">Naming classes</a></li><li class="menu__list-item"><a class="menu__link" href="/web/css/positioning">Positioning</a></li><li class="menu__list-item"><a class="menu__link" href="/web/css/responsive-design">Responsive design</a></li><li class="menu__list-item"><a class="menu__link" href="/web/css/sass-scss">Sass/SCSS</a></li><li class="menu__list-item"><a class="menu__link" href="/web/css/selectors">Selectors</a></li><li class="menu__list-item"><a class="menu__link" href="/web/css/units">Units</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Branch By Abstraction and application strangulation</h1></header><div class="markdown"><p>These techniques allow breaking large changes into chunks of smaller changes that don&#x27;t break the system</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="branch-by-abstraction"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#branch-by-abstraction" title="Direct link to heading">#</a>Branch by abstraction</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="basic-idea"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#basic-idea" title="Direct link to heading">#</a>Basic idea</h3><p>Branch by Abstraction is useful if the team needs to replace a certain component of the system, but this needs to be spread out over multiple commits.</p><p>Basically, this is how it works:</p><ul><li>Write an abstraction layer on top of the component you need to replace</li><li>Make clients call the abstraction layer instead of the original component<ul><li>Could happen in multiple commits</li></ul></li><li>Now, use the abstraction layer to switch over to the new component as it is being built. The new layer of indirection could already forward some calls to the new component, or there could be a toggle indicating which component implementation to use.<ul><li>Will typically happen in multiple commits</li></ul></li><li>Once the new component is fully built and the abstraction layer doesn’t call the old component anymore, get rid of the old component</li><li>Get rid of the abstraction layer</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="anatomy-of-the-abstraction-layer"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#anatomy-of-the-abstraction-layer" title="Direct link to heading">#</a>Anatomy of the abstraction layer</h3><p>Several possibilities:</p><ul><li>Interface that both old and new implementation implement<ul><li>Allows you to choose which of the implementations (old or new) to instantiate when a consumer requires an object conforming to that interface</li></ul></li><li>Actual class that delegates to old or new implementation as needed<ul><li>Could be based on some flag (built into the code or in a configuration file) that allows developers working on the new implementation to test it while others are not affected by it yet.</li><li>Could use the new implementation for some calls and the old implementation for others.</li></ul></li><li>Actual layer in application’s architecture<ul><li>Example: if you are moving to a new persistence framework and you are using a layered architecture, you could already have an abstraction layer in the form of repositories that encapsulate all interaction with the database. This could allow you to make the change one repository at a time, while repositories you didn’t touch are still using the old persistence framework</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="why-not-real-branches"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#why-not-real-branches" title="Direct link to heading">#</a>Why not real branches?</h3><p>Drawbacks of using branches for these kinds of big changes:</p><ul><li>Making large changes means that your branch will probably touch a large part of the codebase. The fact that the changes are large also means you will probably spend a long time working on them, giving the rest of the team plenty of time to make changes to the parts of the codebase you touch in a way that conflicts with what you are doing.</li><li>It’s even worse if your team also uses long-lived branches for regular feature development, because that increases the chances that the rest of the team are making incompatible changes that you don’t know about until the team has already invested a lot of time in them.</li></ul><p>Benefits Branch by Abstraction:</p><ul><li>Allows making changes in an incremental way while keeping the system running at all times</li><li>You can still collaborate with other developers in one single branch, meaning that potential conflicts are detected immediately</li><li>Because the system keeps on working, you could choose to release a working version of the system containing a half-completed migration</li></ul><p>See also <a href="/processes-techniques/trunk-based-development">Trunk Based Development</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="real-world-example"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#real-world-example" title="Direct link to heading">#</a>Real-world example</h3><p>See <a href="https://github.blog/2015-12-15-move-fast/" target="_blank" rel="nofollow noopener noreferrer">Move Fast and Fix Things <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></p><p>GitHub saw the need to replace a critical part of their platform (merges) with a new implementation</p><ul><li>change needs to happen without downtimes while deploying on average 60 times a day</li><li>unacceptable to break existing functionality</li></ul><p>The solution: branch by abstraction!</p><p>Their abstraction layer: <a href="https://github.com/github/scientist" target="_blank" rel="nofollow noopener noreferrer">Scientist <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></p><ul><li>wraps both old and new behavior</li><li>always runs the old behavior</li><li>decides whether to also run new behavior or not</li><li>measures the durations of all behaviors</li><li>always returns what old behavior returns</li><li>swallows and logs any exceptions thrown by new behavior</li><li>logs any discrepancies between the results obtained from the old and new behavior<ul><li>similar to the <em>Duplicate Writes</em> and <em>Dark Reads</em> in Expand-Contract data migrations (see <a href="/data/data-schema-migration">Data schema migration</a>)</li></ul></li></ul><p>This allowed them to test the new implementation on actual production data, comparing both results and performance. After fixing some bugs, it allowed them to be confident enough to completely switch over to the new behavior in production</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="application-strangulation-also-known-as-strangler-pattern"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#application-strangulation-also-known-as-strangler-pattern" title="Direct link to heading">#</a>Application strangulation (also known as Strangler pattern)</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="basic-idea-1"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#basic-idea-1" title="Direct link to heading">#</a>Basic idea</h3><p>Very similar to Branch by Abstraction, but operates at different level:</p><ul><li>Branch by Abstraction happens within a single codebase, using abstraction mechanisms of the programming language</li><li>Application strangulation could be used to migrate between different applications potentially written in completely different languages. The abstraction layer typically comes in the form of a reverse proxy that decides whether to call the API of the old application or the API of the new application (this could depend on the specific call being made and will likely change throughout the migration)</li></ul><p>See the real-world example below, or another real-world example: <a href="https://engineering.shopify.com/blogs/engineering/how-shopify-reduced-storefront-response-times-rewrite" target="_blank" rel="nofollow noopener noreferrer">How Shopify Reduced Storefront Response Times with a Rewrite <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="real-world-example-1"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#real-world-example-1" title="Direct link to heading">#</a>Real-world example</h3><p>See <a href="https://www.theguardian.com/info/2018/nov/30/bye-bye-mongo-hello-postgres" target="_blank" rel="nofollow noopener noreferrer">Bye bye Mongo, Hello Postgres <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></p><p>The Guardian used application strangulation to move from MongoDB to PostgreSQL, keeping their system working while performing the migration. MongoDB would stay their main source of truth until the migration was completed, but in the meantime they also needed to make sure that all of their data got migrated into PostgreSQL and that the system was able to run on PostgreSQL only once fully switched over.</p><p>Branch By Abstraction could have been an option here, but there was very little separation of concerns in the original application so introducing an abstraction layer would have been costly and risky. Instead, decision was made to build a whole new application next to the old one.</p><p>Once the new application was running next to the other one, the team created a reverse proxy that worked as follows:</p><ol><li>Accept incoming traffic</li><li>Forward the traffic to the primary API and return the result to the caller</li><li>Asynchronously forward the traffic to the secondary API</li><li>Compare the results from both APIs and log any differences</li></ol><p>After migrating the existing data, any differences between the results from both APIs would indicate bugs that needed to be solved. If the team got to the point where there were no differences being logged, they could be confident that the new API works in the same way as the old API. Switching the primary and secondary API in the proxy allowed the team to essentially switch to the new API while still having a fallback in the form of the old API that was still receiving all requests.</p><p>The migration of existing data itself also made use of the fact that both applications had the same API. The flow was as follows:</p><ol><li>Get content from the API backed by MongoDB</li><li>Save that content to the API backed by PostgreSQL</li><li>Get the content from the API backed by PostgreSQL</li><li>Verify that the responses from (1) and (3) are identical</li></ol><p>Finally, when everything was working with the new API as primary, the team got rid of the proxy and the old API in order to complete the migration.</p><p>Note that, during the period in which both APIs were running next to each other, calls for both reads and writes were being forwarded to each API and the results were compared. This is very similar to the <em>Duplicate Writes</em> and <em>Dark Reads</em> in Expand-Contract data migrations (see <a href="/data/data-schema-migration">Data schema migration</a>)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="resources"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#resources" title="Direct link to heading">#</a>Resources</h2><ul><li><a href="https://paulhammant.com/blog/branch_by_abstraction.html" target="_blank" rel="nofollow noopener noreferrer">Introducing Branch By Abstraction <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></li><li><a href="https://trunkbaseddevelopment.com/branch-by-abstraction/" target="_blank" rel="nofollow noopener noreferrer">Branch By Abstraction <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></li><li><a href="https://martinfowler.com/bliki/BranchByAbstraction.html" target="_blank" rel="nofollow noopener noreferrer">BranchByAbstraction <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></li><li><a href="https://continuousdelivery.com/2011/05/make-large-scale-changes-incrementally-with-branch-by-abstraction/" target="_blank" rel="nofollow noopener noreferrer">Make Large Scale Changes Incrementally with Branch By Abstraction <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></li><li><a href="https://trunkbaseddevelopment.com/strangulation/" target="_blank" rel="nofollow noopener noreferrer">Application strangulation <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></li></ul></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/preparation/tree"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« Tree</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/processes-techniques/client-first-design"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">Client-first design »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#branch-by-abstraction" class="contents__link">Branch by abstraction</a><ul><li><a href="#basic-idea" class="contents__link">Basic idea</a></li><li><a href="#anatomy-of-the-abstraction-layer" class="contents__link">Anatomy of the abstraction layer</a></li><li><a href="#why-not-real-branches" class="contents__link">Why not real branches?</a></li><li><a href="#real-world-example" class="contents__link">Real-world example</a></li></ul></li><li><a href="#application-strangulation-also-known-as-strangler-pattern" class="contents__link">Application strangulation (also known as Strangler pattern)</a><ul><li><a href="#basic-idea-1" class="contents__link">Basic idea</a></li><li><a href="#real-world-example-1" class="contents__link">Real-world example</a></li></ul></li><li><a href="#resources" class="contents__link">Resources</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>copyright © 2022 shyamzzp.</div></div></div></footer>
</div>

<script src="/styles.a100f0e2.js"></script>

<script src="/runtime~main.10117a48.js"></script>

<script src="/main.b4872909.js"></script>

<script src="/1.a97003e5.js"></script>

<script src="/2.2e8d12a1.js"></script>

<script src="/92.eb9bf858.js"></script>

<script src="/ec1ed54d.e8f02b85.js"></script>

<script src="/17896441.d7ae5b38.js"></script>

<script src="/2cbba78a.6e8f96cf.js"></script>

<script>window.goatcounter={no_events:!0},window.addEventListener("click",t=>{if(!window.goatcounter.count)return;if(!t.target)return;const e=t.target.getAttribute("href");!e||e.startsWith("http")||e.startsWith("#")||setTimeout(()=>{window.goatcounter.count()})})</script>
<script data-goatcounter="https://interview-prep.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>